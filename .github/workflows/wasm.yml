name: Build Wasm Modules
on: [ pull_request ]

env:
  SERENITY_SOURCE_DIR: ${{ github.workspace }}
  SERENITY_CCACHE_DIR: ${{ github.workspace }}/.ccache

jobs:
  build:
    runs-on: ubuntu-24.04
    strategy:
      fail-fast: false

    steps:
      - name: Checkout trflynn89/serenity
        uses: actions/checkout@v6.0.0

      - name: Checkout trflynn89/libjs-data libjs-wasm
        uses: actions/checkout@v6.0.0
        with:
          path: libjs-data
          ref: libjs-wasm
          repository: trflynn89/libjs-data

      - name: "Prepare files"
        run: |
          date > ${{ github.workspace }}/libjs-data/libjs.js

      - name: Deploy to GitHub
        uses: JamesIves/github-pages-deploy-action@v4.7.4
        with:
          git-config-name: BuggieBot
          git-config-email: buggiebot@serenityos.org
          branch: libjs-wasm
          repository-name: trflynn89/libjs-data
          token: ${{ secrets.BUGGIEBOT_TOKEN }}
          folder: ${{ github.workspace }}/libjs-data
